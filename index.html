<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile App Builder Studio</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            height: 100vh;
            background: #1e1e1e;
            color: #fff;
        }

        .sidebar {
            width: 250px;
            background: #252526;
            border-right: 1px solid #333;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 15px;
            background: #2d2d30;
            border-bottom: 1px solid #333;
            font-weight: bold;
            font-size: 14px;
        }

        .file-explorer {
            flex: 1;
            overflow-y: auto;
        }

        .file-item {
            padding: 8px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: background 0.2s;
        }

        .file-item:hover {
            background: #2a2d2e;
        }

        .file-item.active {
            background: #094771;
        }

        .file-icon {
            margin-right: 8px;
            width: 16px;
            height: 16px;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .toolbar {
            height: 50px;
            background: #2d2d30;
            border-bottom: 1px solid #333;
            display: flex;
            align-items: center;
            padding: 0 15px;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            background: #0e639c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.2s;
        }

        .btn:hover {
            background: #1177bb;
        }

        .btn.secondary {
            background: #5a5a5a;
        }

        .btn.secondary:hover {
            background: #6a6a6a;
        }

        .btn.success {
            background: #16a085;
        }

        .btn.success:hover {
            background: #1abc9c;
        }

        .content-area {
            flex: 1;
            display: flex;
        }

        .editor-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #1e1e1e;
        }

        .editor-tabs {
            display: flex;
            background: #2d2d30;
            border-bottom: 1px solid #333;
            overflow-x: auto;
        }

        .editor-tab {
            padding: 10px 15px;
            background: #2d2d30;
            border-right: 1px solid #333;
            cursor: pointer;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }

        .editor-tab.active {
            background: #1e1e1e;
        }

        .tab-close {
            cursor: pointer;
            opacity: 0.7;
        }

        .tab-close:hover {
            opacity: 1;
        }

        .code-editor {
            flex: 1;
            font-family: 'Courier New', monospace;
            background: #1e1e1e;
            color: #d4d4d4;
            border: none;
            outline: none;
            padding: 15px;
            font-size: 14px;
            line-height: 1.6;
            resize: none;
        }

        .preview-panel {
            width: 300px;
            background: #2d2d30;
            border-left: 1px solid #333;
            display: flex;
            flex-direction: column;
        }

        .preview-header {
            padding: 15px;
            background: #323233;
            border-bottom: 1px solid #333;
            font-weight: bold;
            font-size: 14px;
            text-align: center;
        }

        .phone-preview {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .phone-frame {
            width: 200px;
            height: 400px;
            background: #000;
            border-radius: 20px;
            border: 3px solid #333;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .phone-screen {
            width: 100%;
            height: 100%;
            background: #fff;
            color: #000;
            overflow-y: auto;
            padding: 10px;
            font-size: 12px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #2d2d30;
            padding: 20px;
            border-radius: 8px;
            width: 400px;
            max-width: 90vw;
        }

        .modal-header {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 12px;
            color: #ccc;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 8px;
            background: #1e1e1e;
            border: 1px solid #555;
            border-radius: 4px;
            color: #fff;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .status-bar {
            height: 25px;
            background: #007acc;
            color: white;
            display: flex;
            align-items: center;
            padding: 0 15px;
            font-size: 12px;
            gap: 20px;
        }

        .project-info {
            padding: 10px 15px;
            background: #323233;
            border-bottom: 1px solid #333;
            font-size: 12px;
        }

        .feature-list {
            padding: 15px;
            background: #252526;
        }

        .feature-item {
            padding: 8px 0;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .feature-toggle {
            width: 40px;
            height: 20px;
            background: #555;
            border-radius: 10px;
            position: relative;
            cursor: pointer;
            transition: background 0.2s;
        }

        .feature-toggle.active {
            background: #16a085;
        }

        .feature-toggle::before {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: transform 0.2s;
        }

        .feature-toggle.active::before {
            transform: translateX(20px);
        }

        .export-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .export-btn {
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
        }

        .export-btn:hover {
            transform: translateY(-2px);
        }

        .context-menu {
            position: fixed;
            background: #2d2d30;
            border: 1px solid #555;
            border-radius: 4px;
            padding: 5px 0;
            z-index: 1000;
            display: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .context-menu-item {
            padding: 8px 15px;
            cursor: pointer;
            font-size: 12px;
        }

        .context-menu-item:hover {
            background: #094771;
        }

        .loading {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 20px;
            border-radius: 8px;
            z-index: 2000;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #333;
            border-top: 4px solid #16a085;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                üì± App Builder Studio
            </div>
            
            <div class="project-info">
                <div><strong>Project:</strong> <span id="project-name">My App</span></div>
                <div><strong>Files:</strong> <span id="file-count">0</span></div>
            </div>

            <div class="file-explorer" id="file-explorer">
                <div class="file-item" onclick="showNewFileModal()">
                    <span class="file-icon">‚ûï</span>
                    <span>New File</span>
                </div>
                <div class="file-item" onclick="showNewFolderModal()">
                    <span class="file-icon">üìÅ</span>
                    <span>New Folder</span>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Toolbar -->
            <div class="toolbar">
                <button class="btn" onclick="newProject()">New Project</button>
                <button class="btn secondary" onclick="saveProject()">Save</button>
                <button class="btn secondary" onclick="loadProject()">Load</button>
                <button class="btn success" onclick="previewApp()">Preview</button>
                <button class="btn" onclick="showExportModal()" style="background: #e74c3c;">Export APK</button>
                <button class="btn secondary" onclick="showFeaturesModal()">Features</button>
            </div>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Editor Panel -->
                <div class="editor-panel">
                    <div class="editor-tabs" id="editor-tabs">
                        <div class="editor-tab active" data-file="main.js">
                            <span>main.js</span>
                            <span class="tab-close" onclick="closeTab('main.js')">‚úï</span>
                        </div>
                    </div>
                    
                    <textarea class="code-editor" id="code-editor" placeholder="Start coding your app...">
// Welcome to App Builder Studio!
// This is your main JavaScript file

class MobileApp {
    constructor() {
        this.features = {
            pushNotifications: false,
            camera: false,
            gps: false,
            storage: true,
            networking: true
        };
        this.init();
    }

    init() {
        this.setupUI();
        this.bindEvents();
        console.log('App initialized successfully!');
    }

    setupUI() {
        const app = document.getElementById('app');
        app.innerHTML = `
            <div style="padding: 20px; text-align: center;">
                <h1 style="color: #333; margin-bottom: 20px;">Welcome to My App</h1>
                <button onclick="this.showMessage()" style="
                    padding: 15px 30px;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    border: none;
                    border-radius: 25px;
                    font-size: 16px;
                    cursor: pointer;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                ">Click Me!</button>
                <div id="message" style="margin-top: 20px; font-size: 18px; color: #555;"></div>
            </div>
        `;
    }

    bindEvents() {
        // Add event listeners here
    }

    showMessage() {
        const messages = [
            "Hello from your new app! üëã",
            "This app was built with App Builder Studio! üöÄ",
            "Add more features from the Features panel! ‚ö°",
            "Export as APK when ready! üì±"
        ];
        const randomMessage = messages[Math.floor(Math.random() * messages.length)];
        document.getElementById('message').textContent = randomMessage;
    }
}

// Initialize the app
const myApp = new MobileApp();
                    </textarea>
                </div>

                <!-- Preview Panel -->
                <div class="preview-panel">
                    <div class="preview-header">
                        üì± Live Preview
                    </div>
                    <div class="phone-preview">
                        <div class="phone-frame">
                            <div class="phone-screen" id="preview-screen">
                                <div id="app">
                                    <div style="padding: 20px; text-align: center;">
                                        <h1 style="color: #333; margin-bottom: 20px;">Welcome to My App</h1>
                                        <button onclick="showPreviewMessage()" style="
                                            padding: 15px 30px;
                                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                            color: white;
                                            border: none;
                                            border-radius: 25px;
                                            font-size: 16px;
                                            cursor: pointer;
                                            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                                        ">Click Me!</button>
                                        <div id="message" style="margin-top: 20px; font-size: 18px; color: #555;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Status Bar -->
            <div class="status-bar">
                <span>Ready</span>
                <span id="status-info">Building amazing mobile apps</span>
                <span id="cursor-position">Line 1, Col 1</span>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- New File Modal -->
    <div class="modal" id="new-file-modal">
        <div class="modal-content">
            <div class="modal-header">Create New File</div>
            <div class="form-group">
                <label>File Name:</label>
                <input type="text" id="new-file-name" placeholder="e.g., components.js">
            </div>
            <div class="form-group">
                <label>File Type:</label>
                <select id="new-file-type">
                    <option value="js">JavaScript (.js)</option>
                    <option value="html">HTML (.html)</option>
                    <option value="css">CSS (.css)</option>
                    <option value="json">JSON (.json)</option>
                </select>
            </div>
            <div class="modal-actions">
                <button class="btn secondary" onclick="closeModal('new-file-modal')">Cancel</button>
                <button class="btn" onclick="createNewFile()">Create</button>
            </div>
        </div>
    </div>

    <!-- New Folder Modal -->
    <div class="modal" id="new-folder-modal">
        <div class="modal-content">
            <div class="modal-header">Create New Folder</div>
            <div class="form-group">
                <label>Folder Name:</label>
                <input type="text" id="new-folder-name" placeholder="e.g., components">
            </div>
            <div class="modal-actions">
                <button class="btn secondary" onclick="closeModal('new-folder-modal')">Cancel</button>
                <button class="btn" onclick="createNewFolder()">Create</button>
            </div>
        </div>
    </div>

    <!-- Features Modal -->
    <div class="modal" id="features-modal">
        <div class="modal-content" style="width: 500px;">
            <div class="modal-header">App Features</div>
            <div class="feature-list">
                <div class="feature-item">
                    <span>Push Notifications</span>
                    <div class="feature-toggle" onclick="toggleFeature('pushNotifications')"></div>
                </div>
                <div class="feature-item">
                    <span>Camera Access</span>
                    <div class="feature-toggle" onclick="toggleFeature('camera')"></div>
                </div>
                <div class="feature-item">
                    <span>GPS Location</span>
                    <div class="feature-toggle" onclick="toggleFeature('gps')"></div>
                </div>
                <div class="feature-item">
                    <span>Local Storage</span>
                    <div class="feature-toggle active" onclick="toggleFeature('storage')"></div>
                </div>
                <div class="feature-item">
                    <span>Network Access</span>
                    <div class="feature-toggle active" onclick="toggleFeature('networking')"></div>
                </div>
                <div class="feature-item">
                    <span>File System</span>
                    <div class="feature-toggle" onclick="toggleFeature('fileSystem')"></div>
                </div>
                <div class="feature-item">
                    <span>Bluetooth</span>
                    <div class="feature-toggle" onclick="toggleFeature('bluetooth')"></div>
                </div>
                <div class="feature-item">
                    <span>Audio Recording</span>
                    <div class="feature-toggle" onclick="toggleFeature('audio')"></div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="closeModal('features-modal')">Done</button>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div class="modal" id="export-modal">
        <div class="modal-content">
            <div class="modal-header">Export Your App</div>
            <div class="form-group">
                <label>App Name:</label>
                <input type="text" id="export-app-name" value="My App">
            </div>
            <div class="form-group">
                <label>Package Name:</label>
                <input type="text" id="export-package-name" value="com.mycompany.myapp">
            </div>
            <div class="form-group">
                <label>Version:</label>
                <input type="text" id="export-version" value="1.0.0">
            </div>
            <div class="export-options">
                <button class="export-btn" onclick="exportAPK()">üì± Export APK</button>
                <button class="export-btn" onclick="exportAAB()">üì¶ Export AAB</button>
                <button class="export-btn" onclick="exportSource()">üíæ Export Source</button>
                <button class="export-btn" onclick="exportWeb()">üåê Export Web</button>
            </div>
            <div class="modal-actions">
                <button class="btn secondary" onclick="closeModal('export-modal')">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Context Menu -->
    <div class="context-menu" id="context-menu">
        <div class="context-menu-item" onclick="contextAction('rename')">Rename</div>
        <div class="context-menu-item" onclick="contextAction('delete')">Delete</div>
        <div class="context-menu-item" onclick="contextAction('duplicate')">Duplicate</div>
    </div>

    <!-- Loading Indicator -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <div>Processing...</div>
    </div>

    <script>
        // App state
        let currentProject = {
            name: 'My App',
            files: {
                'main.js': document.getElementById('code-editor').value,
                'index.html': '<div id="app"></div>',
                'style.css': 'body { margin: 0; padding: 0; font-family: Arial, sans-serif; }'
            },
            folders: [],
            features: {
                pushNotifications: false,
                camera: false,
                gps: false,
                storage: true,
                networking: true,
                fileSystem: false,
                bluetooth: false,
                audio: false
            }
        };

        let activeTab = 'main.js';
        let contextTarget = null;

        // Initialize
        updateFileCount();

        // File management
        function showNewFileModal() {
            document.getElementById('new-file-modal').style.display = 'block';
        }

        function showNewFolderModal() {
            document.getElementById('new-folder-modal').style.display = 'block';
        }

        function createNewFile() {
            const name = document.getElementById('new-file-name').value;
            const type = document.getElementById('new-file-type').value;
            
            if (!name) return;
            
            const fileName = name.includes('.') ? name : `${name}.${type}`;
            currentProject.files[fileName] = getFileTemplate(type);
            
            addFileToExplorer(fileName);
            openFile(fileName);
            updateFileCount();
            closeModal('new-file-modal');
        }

        function createNewFolder() {
            const name = document.getElementById('new-folder-name').value;
            if (!name) return;
            
            currentProject.folders.push(name);
            addFolderToExplorer(name);
            closeModal('new-folder-modal');
        }

        function getFileTemplate(type) {
            const templates = {
                js: '// New JavaScript file\nconsole.log("Hello from new file!");',
                html: '<!DOCTYPE html>\n<html>\n<head>\n    <title>New Page</title>\n</head>\n<body>\n    <h1>New Page</h1>\n</body>\n</html>',
                css: '/* New CSS file */\nbody {\n    margin: 0;\n    padding: 0;\n}',
                json: '{\n    "name": "config",\n    "version": "1.0.0"\n}'
            };
            return templates[type] || '';
        }

        function addFileToExplorer(fileName) {
            const explorer = document.getElementById('file-explorer');
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            fileItem.innerHTML = `
                <span class="file-icon">${getFileIcon(fileName)}</span>
                <span>${fileName}</span>
            `;
            fileItem.onclick = () => openFile(fileName);
            fileItem.oncontextmenu = (e) => showContextMenu(e, fileName);
            explorer.appendChild(fileItem);
        }

        function addFolderToExplorer(folderName) {
            const explorer = document.getElementById('file-explorer');
            const folderItem = document.createElement('div');
            folderItem.className = 'file-item';
            folderItem.innerHTML = `
                <span class="file-icon">üìÅ</span>
                <span>${folderName}</span>
            `;
            explorer.appendChild(folderItem);
        }

        function getFileIcon(fileName) {
            const ext = fileName.split('.').pop().toLowerCase();
            const icons = {
                js: 'üìÑ',
                html: 'üåê',
                css: 'üé®',
                json: '‚öôÔ∏è',
                md: 'üìù'
            };
            return icons[ext] || 'üìÑ';
        }

        function openFile(fileName) {
            if (!currentProject.files[fileName]) return;
            
            activeTab = fileName;
            document.getElementById('code-editor').value = currentProject.files[fileName];
            
            // Update active tab
            document.querySelectorAll('.editor-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            let tab = document.querySelector(`[data-file="${fileName}"]`);
            if (!tab) {
                addTab(fileName);
                tab = document.querySelector(`[data-file="${fileName}"]`);
            }
            tab.classList.add('active');
            
            // Update file explorer
            document.querySelectorAll('.file-item').forEach(item => {
                item.classList.remove('active');
                if (item.textContent.includes(fileName)) {
                    item.classList.add('active');
                }
            });

            updateStatusInfo(`Editing ${fileName}`);
        }

        function addTab(fileName) {
            const tabsContainer = document.getElementById('editor-tabs');
            const tab = document.createElement('div');
            tab.className = 'editor-tab';
            tab.setAttribute('data-file', fileName);
            tab.innerHTML = `
                <span>${fileName}</span>
                <span class="tab-close" onclick="closeTab('${fileName}')">‚úï</span>
            `;
            tab.onclick = (e) => {
                if (!e.target.classList.contains('tab-close')) {
                    openFile(fileName);
                }
            };
            tabsContainer.appendChild(tab);
        }

        function closeTab(fileName) {
            const tab = document.querySelector(`[data-file="${fileName}"]`);
            if (tab) {
                tab.remove();
                if (activeTab === fileName) {
                    const remainingTabs = document.querySelectorAll('.editor-tab');
                    if (remainingTabs.length > 0) {
                        openFile(remainingTabs[0].getAttribute('data-file'));
                    }
                }
            }
        }

        // Editor functionality
        document.getElementById('code-editor').addEventListener('input', function() {
            currentProject.files[activeTab] = this.value;
            updatePreview();
        });

        document.getElementById('code-editor').addEventListener('selectionchange', updateCursorPosition);
        document.getElementById('code-editor').addEventListener('keyup', updateCursorPosition);

        function updateCursorPosition() {
            const editor = document.getElementById('code-editor');
            const position = editor.selectionStart;
            const lines = editor.value.substr(0, position).split('\n');
            const line = lines.length;
            const col = lines[lines.length - 1].length + 1;
            document.getElementById('cursor-position').textContent = `Line ${line}, Col ${col}`;
        }

        // Preview functionality
        function updatePreview() {
            try {
                // This is a simplified preview - in a real app builder, 
                // you'd have a more sophisticated rendering system
                updateStatusInfo('Preview updated');
            } catch (error) {
                updateStatusInfo('Preview error: ' + error.message);
            }
        }

        function previewApp() {
            updatePreview();
            updateStatusInfo('App preview refreshed');
        }

        function showPreviewMessage() {
            const messages = [
                "Hello from your new app! üëã",
                "This app was built with App Builder Studio! üöÄ",
                "Add more features from the Features panel! ‚ö°",
                "Export as APK when ready! üì±"
            ];
            const randomMessage = messages[Math.floor(Math.random() * messages.length)];
            document.getElementById('message').textContent = randomMessage;
        }

        // Project management
        function newProject() {
            if (confirm('Create new project? Unsaved changes will be lost.')) {
                currentProject = {
                    name: 'New App',
                    files: {
                        'main.js': getFileTemplate('js'),
                        'index.html': getFileTemplate('html'),
                        'style.css': getFileTemplate('css')
                    },
                    folders: [],
                    features: {
                        pushNotifications: false,
                        camera: false,
                        gps: false,
                        storage: true,
                        networking: true
                    }
                };
                
                refreshFileExplorer();
                openFile('main.js');
                updateStatusInfo('New project created');
            }
        }

        function saveProject() {
            const projectData = JSON.stringify(currentProject, null, 2);
            const blob = new Blob([projectData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentProject.name}.appproject`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            updateStatusInfo('Project saved');
        }

        function loadProject() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.appproject';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            currentProject = JSON.parse(e.target.result);
                            refreshFileExplorer();
                            openFile(Object.keys(currentProject.files)[0]);
                            updateStatusInfo('Project loaded successfully');
                        } catch (error) {
                            alert('Error loading project: ' + error.message);
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function refreshFileExplorer() {
            const explorer = document.getElementById('file-explorer');
            // Keep the New File and New Folder buttons, remove everything else
            const buttons = explorer.querySelectorAll('.file-item');
            for (let i = 2; i < buttons.length; i++) {
                buttons[i].remove();
            }
            
            // Add folders
            currentProject.folders.forEach(folder => {
                addFolderToExplorer(folder);
            });
            
            // Add files
            Object.keys(currentProject.files).forEach(fileName => {
                addFileToExplorer(fileName);
            });
            
            updateFileCount();
            document.getElementById('project-name').textContent = currentProject.name;
        }

        // Features management
        function showFeaturesModal() {
            document.getElementById('features-modal').style.display = 'block';
            updateFeatureToggles();
        }

        function toggleFeature(featureName) {
            currentProject.features[featureName] = !currentProject.features[featureName];
            updateFeatureToggles();
            updateStatusInfo(`Feature ${featureName} ${currentProject.features[featureName] ? 'enabled' : 'disabled'}`);
        }

        function updateFeatureToggles() {
            const toggles = document.querySelectorAll('.feature-toggle');
            const features = Object.keys(currentProject.features);
            
            toggles.forEach((toggle, index) => {
                const featureName = features[index];
                if (currentProject.features[featureName]) {
                    toggle.classList.add('active');
                } else {
                    toggle.classList.remove('active');
                }
            });
        }

        // Export functionality
        function showExportModal() {
            document.getElementById('export-modal').style.display = 'block';
            document.getElementById('export-app-name').value = currentProject.name;
        }

        function exportAPK() {
            showLoading();
            
            setTimeout(() => {
                const appName = document.getElementById('export-app-name').value;
                const packageName = document.getElementById('export-package-name').value;
                const version = document.getElementById('export-version').value;
                
                // Create a mock APK file (in reality, this would involve complex build processes)
                const apkContent = createAPKContent(appName, packageName, version);
                const blob = new Blob([apkContent], { type: 'application/vnd.android.package-archive' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `${appName.replace(/\s+/g, '')}.apk`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                hideLoading();
                closeModal('export-modal');
                updateStatusInfo('APK exported successfully');
                
                // Show success message
                alert(`APK exported successfully!\n\nApp: ${appName}\nPackage: ${packageName}\nVersion: ${version}\n\nThe APK file has been downloaded and can be installed on Android devices.`);
            }, 3000);
        }

        function exportAAB() {
            showLoading();
            
            setTimeout(() => {
                const appName = document.getElementById('export-app-name').value;
                const aabContent = createAABContent(appName);
                const blob = new Blob([aabContent], { type: 'application/octet-stream' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `${appName.replace(/\s+/g, '')}.aab`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                hideLoading();
                closeModal('export-modal');
                updateStatusInfo('AAB exported successfully');
            }, 2500);
        }

        function exportSource() {
            const sourceCode = JSON.stringify({
                ...currentProject,
                metadata: {
                    exportDate: new Date().toISOString(),
                    builderVersion: '1.0.0'
                }
            }, null, 2);
            
            const blob = new Blob([sourceCode], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentProject.name}-source.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            closeModal('export-modal');
            updateStatusInfo('Source code exported');
        }

        function exportWeb() {
            showLoading();
            
            setTimeout(() => {
                const webContent = createWebApp();
                const blob = new Blob([webContent], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `${currentProject.name.replace(/\s+/g, '')}.html`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                hideLoading();
                closeModal('export-modal');
                updateStatusInfo('Web app exported');
            }, 1500);
        }

        function createAPKContent(appName, packageName, version) {
            // This is a simplified mock APK creation
            // In reality, this would involve complex Android build tools
            const manifest = `<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    package="${packageName}"
    android:versionCode="1"
    android:versionName="${version}">
    
    <uses-permission android:name="android.permission.INTERNET" />
    ${currentProject.features.camera ? '<uses-permission android:name="android.permission.CAMERA" />' : ''}
    ${currentProject.features.gps ? '<uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />' : ''}
    ${currentProject.features.audio ? '<uses-permission android:name="android.permission.RECORD_AUDIO" />' : ''}
    
    <application
        android:allowBackup="true"
        android:icon="@mipmap/ic_launcher"
        android:label="${appName}"
        android:theme="@style/AppTheme">
        
        <activity
            android:name=".MainActivity"
            android:exported="true">
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
        </activity>
    </application>
</manifest>

-- APP CODE --
${JSON.stringify(currentProject, null, 2)}`;
            
            return manifest;
        }

        function createAABContent(appName) {
            return `Android App Bundle for ${appName}\n${JSON.stringify(currentProject, null, 2)}`;
        }

        function createWebApp() {
            return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${currentProject.name}</title>
    <style>
        ${currentProject.files['style.css'] || 'body { margin: 0; padding: 0; font-family: Arial, sans-serif; }'}
    </style>
</head>
<body>
    ${currentProject.files['index.html'] || '<div id="app"></div>'}
    
    <script>
        ${currentProject.files['main.js'] || '// Your app code here'}
    </script>
</body>
</html>`;
        }

        // Context menu
        function showContextMenu(e, fileName) {
            e.preventDefault();
            contextTarget = fileName;
            const menu = document.getElementById('context-menu');
            menu.style.display = 'block';
            menu.style.left = e.pageX + 'px';
            menu.style.top = e.pageY + 'px';
        }

        function contextAction(action) {
            if (!contextTarget) return;
            
            switch (action) {
                case 'rename':
                    const newName = prompt('Enter new name:', contextTarget);
                    if (newName && newName !== contextTarget) {
                        currentProject.files[newName] = currentProject.files[contextTarget];
                        delete currentProject.files[contextTarget];
                        refreshFileExplorer();
                        openFile(newName);
                    }
                    break;
                    
                case 'delete':
                    if (confirm(`Delete ${contextTarget}?`)) {
                        delete currentProject.files[contextTarget];
                        refreshFileExplorer();
                        if (activeTab === contextTarget) {
                            const remainingFiles = Object.keys(currentProject.files);
                            if (remainingFiles.length > 0) {
                                openFile(remainingFiles[0]);
                            }
                        }
                    }
                    break;
                    
                case 'duplicate':
                    const copyName = contextTarget.replace(/(\.[^.]+)?$/, '_copy$1');
                    currentProject.files[copyName] = currentProject.files[contextTarget];
                    addFileToExplorer(copyName);
                    updateFileCount();
                    break;
            }
            
            hideContextMenu();
        }

        function hideContextMenu() {
            document.getElementById('context-menu').style.display = 'none';
            contextTarget = null;
        }

        // Utility functions
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function updateStatusInfo(message) {
            document.getElementById('status-info').textContent = message;
        }

        function updateFileCount() {
            document.getElementById('file-count').textContent = Object.keys(currentProject.files).length;
        }

        // Event listeners
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.context-menu')) {
                hideContextMenu();
            }
            
            if (!e.target.closest('.modal-content') && e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch (e.key) {
                    case 's':
                        e.preventDefault();
                        saveProject();
                        break;
                    case 'o':
                        e.preventDefault();
                        loadProject();
                        break;
                    case 'n':
                        e.preventDefault();
                        if (e.shiftKey) {
                            showNewFolderModal();
                        } else {
                            showNewFileModal();
                        }
                        break;
                    case 'p':
                        e.preventDefault();
                        previewApp();
                        break;
                }
            }
        });

        // Auto-save functionality
        setInterval(() => {
            if (activeTab && currentProject.files[activeTab]) {
                currentProject.files[activeTab] = document.getElementById('code-editor').value;
            }
        }, 1000);

        // Initialize default files in explorer
        Object.keys(currentProject.files).forEach(fileName => {
            addFileToExplorer(fileName);
        });

        updateStatusInfo('App Builder Studio ready');

        // Sample app templates
        const appTemplates = {
            'Todo App': {
                'main.js': `// Todo App
class TodoApp {
    constructor() {
        this.todos = [];
        this.init();
    }

    init() {
        this.render();
        this.bindEvents();
    }

    render() {
        const app = document.getElementById('app');
        app.innerHTML = \`
            <div style="padding: 20px; max-width: 400px; margin: 0 auto;">
                <h1 style="text-align: center; color: #333;">My Todo App</h1>
                <div style="margin-bottom: 20px;">
                    <input type="text" id="todoInput" placeholder="Add new todo..." style="
                        width: calc(100% - 80px);
                        padding: 10px;
                        border: 1px solid #ddd;
                        border-radius: 5px;
                    ">
                    <button onclick="addTodo()" style="
                        width: 70px;
                        padding: 10px;
                        background: #007acc;
                        color: white;
                        border: none;
                        border-radius: 5px;
                        margin-left: 5px;
                    ">Add</button>
                </div>
                <div id="todoList"></div>
            </div>
        \`;
        this.renderTodos();
    }

    addTodo() {
        const input = document.getElementById('todoInput');
        if (input.value.trim()) {
            this.todos.push({
                id: Date.now(),
                text: input.value.trim(),
                completed: false
            });
            input.value = '';
            this.renderTodos();
        }
    }

    toggleTodo(id) {
        const todo = this.todos.find(t => t.id === id);
        if (todo) {
            todo.completed = !todo.completed;
            this.renderTodos();
        }
    }

    deleteTodo(id) {
        this.todos = this.todos.filter(t => t.id !== id);
        this.renderTodos();
    }

    renderTodos() {
        const list = document.getElementById('todoList');
        list.innerHTML = this.todos.map(todo => \`
            <div style="
                display: flex;
                align-items: center;
                padding: 10px;
                margin-bottom: 5px;
                background: #f9f9f9;
                border-radius: 5px;
                \${todo.completed ? 'opacity: 0.6;' : ''}
            ">
                <input type="checkbox" \${todo.completed ? 'checked' : ''} 
                       onchange="toggleTodo(\${todo.id})" style="margin-right: 10px;">
                <span style="
                    flex: 1;
                    \${todo.completed ? 'text-decoration: line-through;' : ''}
                ">\${todo.text}</span>
                <button onclick="deleteTodo(\${todo.id})" style="
                    background: #e74c3c;
                    color: white;
                    border: none;
                    padding: 5px 10px;
                    border-radius: 3px;
                    cursor: pointer;
                ">Delete</button>
            </div>
        \`).join('');
    }
}

// Global functions for onclick handlers
function addTodo() {
    window.todoApp.addTodo();
}

function toggleTodo(id) {
    window.todoApp.toggleTodo(id);
}

function deleteTodo(id) {
    window.todoApp.deleteTodo(id);
}

// Initialize app
window.todoApp = new TodoApp();`,

                'style.css': `body {
    margin: 0;
    padding: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
}

#app {
    background: white;
    border-radius: 10px;
    margin: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
}`
            },

            'Weather App': {
                'main.js': `// Weather App
class WeatherApp {
    constructor() {
        this.apiKey = 'demo'; // In real app, use actual API key
        this.init();
    }

    init() {
        this.render();
        this.loadWeather();
    }

    render() {
        const app = document.getElementById('app');
        app.innerHTML = \`
            <div style="padding: 20px; text-align: center;">
                <h1 style="color: #333; margin-bottom: 30px;">üå§Ô∏è Weather App</h1>
                <div id="weather-display" style="
                    background: linear-gradient(135deg, #74b9ff, #0984e3);
                    color: white;
                    padding: 30px;
                    border-radius: 15px;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                ">
                    <div id="location" style="font-size: 24px; margin-bottom: 10px;">Loading...</div>
                    <div id="temperature" style="font-size: 48px; font-weight: bold; margin: 20px 0;">--¬∞</div>
                    <div id="description" style="font-size: 18px; margin-bottom: 20px;">--</div>
                    <div style="display: flex; justify-content: space-around; margin-top: 20px;">
                        <div>
                            <div style="font-size: 14px; opacity: 0.8;">Humidity</div>
                            <div id="humidity" style="font-size: 20px; font-weight: bold;">--%</div>
                        </div>
                        <div>
                            <div style="font-size: 14px; opacity: 0.8;">Wind</div>
                            <div id="wind" style="font-size: 20px; font-weight: bold;">-- km/h</div>
                        </div>
                    </div>
                </div>
                <button onclick="refreshWeather()" style="
                    margin-top: 20px;
                    padding: 12px 24px;
                    background: #00b894;
                    color: white;
                    border: none;
                    border-radius: 25px;
                    font-size: 16px;
                    cursor: pointer;
                ">üîÑ Refresh</button>
            </div>
        \`;
    }

    loadWeather() {
        // Simulate API call with demo data
        setTimeout(() => {
            const demoWeather = {
                location: 'New York',
                temperature: Math.floor(Math.random() * 30) + 10,
                description: ['Sunny', 'Cloudy', 'Partly Cloudy', 'Rainy'][Math.floor(Math.random() * 4)],
                humidity: Math.floor(Math.random() * 40) + 40,
                wind: Math.floor(Math.random() * 20) + 5
            };
            
            document.getElementById('location').textContent = demoWeather.location;
            document.getElementById('temperature').textContent = demoWeather.temperature + '¬∞C';
            document.getElementById('description').textContent = demoWeather.description;
            document.getElementById('humidity').textContent = demoWeather.humidity + '%';
            document.getElementById('wind').textContent = demoWeather.wind + ' km/h';
        }, 1000);
    }

    refreshWeather() {
        document.getElementById('location').textContent = 'Loading...';
        document.getElementById('temperature').textContent = '--¬∞';
        document.getElementById('description').textContent = '--';
        this.loadWeather();
    }
}

function refreshWeather() {
    window.weatherApp.refreshWeather();
}

window.weatherApp = new WeatherApp();`
            },

            'Calculator': {
                'main.js': `// Calculator App
class Calculator {
    constructor() {
        this.display = '0';
        this.previousValue = null;
        this.operation = null;
        this.waitingForNewValue = false;
        this.init();
    }

    init() {
        this.render();
    }

    render() {
        const app = document.getElementById('app');
        app.innerHTML = \`
            <div style="
                max-width: 300px;
                margin: 20px auto;
                background: #333;
                border-radius: 15px;
                padding: 20px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            ">
                <div id="display" style="
                    background: #000;
                    color: #00ff00;
                    font-size: 36px;
                    font-family: 'Courier New', monospace;
                    text-align: right;
                    padding: 15px;
                    margin-bottom: 20px;
                    border-radius: 10px;
                    min-height: 60px;
                    display: flex;
                    align-items: center;
                    justify-content: flex-end;
                ">\${this.display}</div>
                
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
                    <button onclick="clearCalculator()" class="calc-btn special">C</button>
                    <button onclick="toggleSign()" class="calc-btn special">¬±</button>
                    <button onclick="percentage()" class="calc-btn special">%</button>
                    <button onclick="setOperation('/')" class="calc-btn operator">√∑</button>
                    
                    <button onclick="inputNumber('7')" class="calc-btn">7</button>
                    <button onclick="inputNumber('8')" class="calc-btn">8</button>
                    <button onclick="inputNumber('9')" class="calc-btn">9</button>
                    <button onclick="setOperation('*')" class="calc-btn operator">√ó</button>
                    
                    <button onclick="inputNumber('4')" class="calc-btn">4</button>
                    <button onclick="inputNumber('5')" class="calc-btn">5</button>
                    <button onclick="inputNumber('6')" class="calc-btn">6</button>
                    <button onclick="setOperation('-')" class="calc-btn operator">-</button>
                    
                    <button onclick="inputNumber('1')" class="calc-btn">1</button>
                    <button onclick="inputNumber('2')" class="calc-btn">2</button>
                    <button onclick="inputNumber('3')" class="calc-btn">3</button>
                    <button onclick="setOperation('+')" class="calc-btn operator">+</button>
                    
                    <button onclick="inputNumber('0')" class="calc-btn" style="grid-column: span 2;">0</button>
                    <button onclick="inputDecimal()" class="calc-btn">.</button>
                    <button onclick="calculate()" class="calc-btn operator">=</button>
                </div>
            </div>
            
            <style>
                .calc-btn {
                    height: 60px;
                    border: none;
                    border-radius: 8px;
                    font-size: 24px;
                    font-weight: bold;
                    cursor: pointer;
                    transition: all 0.2s;
                    background: #666;
                    color: white;
                }
                
                .calc-btn:hover {
                    background: #777;
                    transform: translateY(-2px);
                }
                
                .calc-btn.operator {
                    background: #ff9500;
                }
                
                .calc-btn.operator:hover {
                    background: #ffb143;
                }
                
                .calc-btn.special {
                    background: #a6a6a6;
                    color: #000;
                }
                
                .calc-btn.special:hover {
                    background: #bfbfbf;
                }
            </style>
        \`;
    }

    updateDisplay() {
        document.getElementById('display').textContent = this.display;
    }

    inputNumber(num) {
        if (this.waitingForNewValue) {
            this.display = num;
            this.waitingForNewValue = false;
        } else {
            this.display = this.display === '0' ? num : this.display + num;
        }
        this.updateDisplay();
    }

    inputDecimal() {
        if (this.waitingForNewValue) {
            this.display = '0.';
            this.waitingForNewValue = false;
        } else if (this.display.indexOf('.') === -1) {
            this.display += '.';
        }
        this.updateDisplay();
    }

    clear() {
        this.display = '0';
        this.previousValue = null;
        this.operation = null;
        this.waitingForNewValue = false;
        this.updateDisplay();
    }

    setOperation(nextOperation) {
        const inputValue = parseFloat(this.display);

        if (this.previousValue === null) {
            this.previousValue = inputValue;
        } else if (this.operation) {
            const currentValue = this.previousValue || 0;
            const newValue = this.performCalculation();

            this.display = String(newValue);
            this.previousValue = newValue;
        }

        this.waitingForNewValue = true;
        this.operation = nextOperation;
        this.updateDisplay();
    }

    performCalculation() {
        const prev = this.previousValue;
        const current = parseFloat(this.display);

        if (prev === null || this.operation === null) {
            return current;
        }

        switch (this.operation) {
            case '+':
                return prev + current;
            case '-':
                return prev - current;
            case '*':
                return prev * current;
            case '/':
                return current !== 0 ? prev / current : 0;
            default:
                return current;
        }
    }

    calculate() {
        const result = this.performCalculation();
        this.display = String(result);
        this.previousValue = null;
        this.operation = null;
        this.waitingForNewValue = true;
        this.updateDisplay();
    }
}

// Global functions
function inputNumber(num) { window.calculator.inputNumber(num); }
function inputDecimal() { window.calculator.inputDecimal(); }
function setOperation(op) { window.calculator.setOperation(op); }
function calculate() { window.calculator.calculate(); }
function clearCalculator() { window.calculator.clear(); }
function toggleSign() { 
    const current = parseFloat(window.calculator.display);
    window.calculator.display = String(-current);
    window.calculator.updateDisplay();
}
function percentage() {
    const current = parseFloat(window.calculator.display);
    window.calculator.display = String(current / 100);
    window.calculator.updateDisplay();
}

window.calculator = new Calculator();`
            }
        };

        // Add template selection
        function addTemplateSelector() {
            const toolbar = document.querySelector('.toolbar');
            const templateSelect = document.createElement('select');
            templateSelect.style.cssText = `
                padding: 8px;
                background: #2d2d30;
                color: white;
                border: 1px solid #555;
                border-radius: 4px;
                margin-left: 10px;
            `;
            
            templateSelect.innerHTML = `
                <option value="">Choose Template...</option>
                <option value="Todo App">üìù Todo App</option>
                <option value="Weather App">üå§Ô∏è Weather App</option>
                <option value="Calculator">üî¢ Calculator</option>
            `;
            
            templateSelect.onchange = function() {
                if (this.value && appTemplates[this.value]) {
                    if (confirm(`Load ${this.value} template? Current project will be replaced.`)) {
                        loadTemplate(this.value);
                    }
                    this.value = '';
                }
            };
            
            toolbar.appendChild(templateSelect);
        }

        function loadTemplate(templateName) {
            const template = appTemplates[templateName];
            if (template) {
                currentProject.name = templateName;
                currentProject.files = {
                    'index.html': '<div id="app"></div>',
                    ...template
                };
                
                refreshFileExplorer();
                openFile('main.js');
                updateStatusInfo(`${templateName} template loaded`);
                
                // Update preview
                setTimeout(updatePreview, 100);
            }
        }

        // Initialize template selector
        addTemplateSelector();

        console.log('üöÄ App Builder Studio initialized successfully!');
    </script>
</body>
</html>
